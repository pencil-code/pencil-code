#!/bin/bash
#
# Generate code coverage reports. Before running this script, pc_auto-test
# should've been run with the --coverage flag. It is recommended to also use
# the -C flag in case this is the first time you are generating code coverage
# reports
# 
# Known issues:
# - Information on which tests access a particular line is not displayed.
#
# 2025-Dec-09/Kishore: coded

set -e

njobs=4

#clean up old files
find "$PENCIL_HOME"/samples -type f -name coverage.info -execdir rm {} \;
rm -f pencil-codecov.info
rm -rf lcov_html

geninfo "$PENCIL_HOME"/samples -b "$PENCIL_HOME"/src -o pencil-codecov.info --ignore-errors inconsistent,inconsistent --filter missing --parallel "$njobs"

genhtml --output-directory "$PENCIL_HOME"/lcov_html pencil-codecov.info
