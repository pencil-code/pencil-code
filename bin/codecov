#!/bin/bash
#
# Generate code coverage reports. Before running this script, pc_auto-test should've been run with the --coverage flag.
#
# 2025-Dec-09/Kishore: coded

set -e

njobs=4

#clean up old files
find "$PENCIL_HOME"/samples -type f -name coverage.info -execdir rm {} \;
if test -e lcov_html; then
	rm -r lcov_html
fi

geninfo "$PENCIL_HOME"/samples -b "$PENCIL_HOME"/src -o pencil-codecov.info --ignore-errors inconsistent,inconsistent --filter missing --parallel "$njobs"

genhtml --output-directory "$PENCIL_HOME"/lcov_html pencil-codecov.info
